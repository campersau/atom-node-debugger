"use 6to5";

var Rx = require('rx-dom');
var pipe = require('app/pipe');

module.exports = function action() {
  var heightOffsetChanged$ = new Rx.Subject();
  var dragStart = new Rx.Subject();

  dragStart
    .map(e => e.screenY)
    .flatMap(function(start) {
      return Rx.DOM
        .mousemove(window.document)
        .map(e => e.screenY)
        .map(y => start - y)
        .takeUntil(Rx.DOM.mouseup(window.document));
    })
    .subscribe(
      offset => heightOffsetChanged$.onNext(offset),
      () => heightOffsetChanged$.onCompleted(),
      err => heightOffsetChanged$.onError(err)
    );

  return {
    observe(view) {
      pipe(view.dragStart$, dragStart);
    },
    heightOffsetChanged$: heightOffsetChanged$,
    changeHeightStarted$: dragStart
  };
};
